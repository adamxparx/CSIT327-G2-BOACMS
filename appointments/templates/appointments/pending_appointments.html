{% extends 'accounts/staff_dashboard.html' %}
{% load static %}

{% block title %}Appointments | Pending{% endblock %}

{% block staff_extra_css %}

<link rel="stylesheet" href="{% static 'appointments/css/table.css' %}">
<link rel="stylesheet" href="{% static 'appointments/css/alerts.css' %}">

{% endblock %}

{% block content %}

<h2 class="appointments_title">Pending Appointments</h2>
<div class="appointments-summary">
    <h4>Pending Appointments: {{ appointments.count }}</h4>
</div>

{% if messages %}
    <div>
        {% for message in messages %}
            <div class="message_success">
                {{ message }} Proceed to <a href="{% url 'approved_appointments' %}"><b>Approved Appointments</b></a> to manage approved appointments.
            </div>
        {% endfor %}
    </div>
{% endif %}

<table class="table_pending">
    <thead>
        <tr>
            <th>Resident Name</th>
            <th>Certificate Type</th>
            <th>Appointment Date</th>
            <th>Appointment Time</th>
            <th>Purpose</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% if appointments %}
            {% for appointment in appointments %}
            <tr>
                <td data-label="Resident Name">{{ appointment.resident.resident.last_name }}, {{ appointment.resident.resident.first_name }} {% if appointment.resident.resident.middle_name %}{{ appointment.resident.resident.middle_name|slice:":1" }}.{% endif %}</td>
                <td data-label="Certificate Type">{{ appointment.get_certificate_type_display }}</td>
                <td data-label="Date">{{ appointment.preferred_date }}</td>
                <td data-label="Time">{{ appointment.preferred_time }}</td>
                <td data-label="Purpose">{{ appointment.purpose }}</td>
                <td data-label="Status">
                    <span class="status-badge status-pending">Pending</span>
                </td>
                <td data-label="Actions">
                    <div class="status-actions">
                        <form method="post" class="status-actions__form">
                            {% csrf_token %}
                            <input type="hidden" name="appointment_id" value="{{ appointment.id }}">
                            <button type="submit"
                                    class="status-button status-button--approve"
                                    aria-label="Approve appointment for {{ appointment.resident.resident.first_name }} {{ appointment.resident.resident.last_name }}"
                                    {% if appointment.status == 'approved' or appointment.status == 'completed' or appointment.status == 'cancelled' %}disabled{% endif %}>
                                Approve
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td class="appointments_info" colspan="7">No pending appointments.</td>
            </tr>
        {% endif %}
    </tbody>
</table>

{% endblock %}