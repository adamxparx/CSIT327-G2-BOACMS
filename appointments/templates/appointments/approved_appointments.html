{% extends 'accounts/staff_dashboard.html' %}
{% load static %}

{% block title %}Appointments | Approved{% endblock %}

{% block staff_extra_css %}

<link rel="stylesheet" href="{% static 'appointments/css/table.css' %}">
<link rel="stylesheet" href="{% static 'appointments/css/alerts.css' %}">

{% endblock %}

{% block content %}

<h4 class="appointments_title">Approved Appointments</h4>

{% if messages %}
    <div>
        {% for message in messages %}
            <div class="message_success">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}


<h5>Today</h5>
<table class="table_approved">
    <tr>
        <th>Resident Name</th>
        <th>Certificate Type</th>
        <th>Appointment Date</th>
        <th>Appointment Time</th>
        <th>Purpose</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>
    {% if appointments_today %}
        {% for appointment in appointments_today %}
        <tr>
            <td>{{ appointment.resident.resident.last_name }}, {{ appointment.resident.resident.first_name }} {% if appointment.resident.resident.middle_name %}{{ appointment.resident.resident.middle_name|slice:":1" }}.{% endif %}</td>
            <td>{{ appointment.get_certificate_type_display }}</td>
            <td>{{ appointment.preferred_date }}</td>
            <td>{{ appointment.preferred_time }}</td>
            <td>{{ appointment.purpose }}</td>
            <td>{{ appointment.status }}</td>
            <td>
                <div class="status-actions">
                    <form method="post" class="status-actions__form">
                        {% csrf_token %}
                        <input type="hidden" name="appointment_id" value="{{ appointment.id }}">
                        <button type="submit"
                                name="action"
                                value="reschedule"
                                class="status-button status-button--reschedule"
                                aria-label="Reschedule appointment for {{ appointment.resident.resident.first_name }} {{ appointment.resident.resident.last_name }}">
                            Reschedule
                        </button>
                        <button type="submit"
                                name="action"
                                value="complete"
                                class="status-button status-button--complete"
                                aria-label="Mark complete appointment for {{ appointment.resident.resident.first_name }} {{ appointment.resident.resident.last_name }}">
                            Complete
                        </button>
                    </form>
                </div>
            </td>
        </tr>
        {% endfor %}
    {% else %}
        <tr>
            <td class="appointments_info" colspan="7">No appointments for today.</td>
        </tr>
    {% endif %}
</table>


<h5>Other Appointments</h5>
<table class="table_approved">
    <tr>
        <th>Resident Name</th>
        <th>Certificate Type</th>
        <th>Appointment Date</th>
        <th>Appointment Time</th>
        <th>Purpose</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>
    {% for appointment in appointments %}
    <tr>
        <td>{{ appointment.resident.resident.last_name }}, {{ appointment.resident.resident.first_name }} {% if appointment.resident.resident.middle_name %}{{ appointment.resident.resident.middle_name|slice:":1" }}.{% endif %}</td>
        <td>{{ appointment.get_certificate_type_display }}</td>
        <td>{{ appointment.preferred_date }}</td>
        <td>{{ appointment.preferred_time }}</td>
        <td>{{ appointment.purpose }}</td>
        <td>{{ appointment.status }}</td>
        <td>
            <div class="status-actions">
                <form method="post" class="status-actions__form">
                    {% csrf_token %}
                    <input type="hidden" name="appointment_id" value="{{ appointment.id }}">
                    <button type="submit"
                            name="action"
                            value="reschedule"
                            class="status-button status-button--reschedule"
                            aria-label="Reschedule appointment for {{ appointment.resident.resident.first_name }} {{ appointment.resident.resident.last_name }}">
                        Reschedule
                    </button>
                </form>
            </div>
        </td>
    </tr>
    {% endfor %}
</table>

{% endblock %}