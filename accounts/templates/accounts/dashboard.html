{% extends 'accounts/base_dashboard.html' %}
{% load static %}

{% block title %}{{ user.resident.last_name }} | Dashboard{% endblock %}

{% block resident_css %}
    <link rel="stylesheet" href="{% static 'accounts/css/dropdown.css' %}">
    <style>
        .resident-name-link {
            color: inherit;
            text-decoration: none;
        }
        .resident-name-link:hover {
            text-decoration: none;
        }
    </style>
{% endblock %}

{% block appbar %}
    <ul>
        <li><a href="{% url 'dashboard' %}" {% if request.resolver_match.url_name == 'dashboard' %}aria-current="page"{% endif %}>HOME</a></li>
        <li><a href="{% url 'certification' %}" {% if request.resolver_match.url_name == 'certification' or request.resolver_match.url_name == 'create_appointment' %}aria-current="page"{% endif %}>CERTIFICATIONS</a></li>
        <li><a href="{% url 'appointments' %}" {% if request.resolver_match.url_name == 'appointments' or request.resolver_match.url_name == 'appointment_detail' %}aria-current="page"{% endif %}>APPOINTMENTS {% if claimed_appointments %}<button class="appointment_count approved_count">{{ claimed_appointments }}</button>{% endif %}</a></li>
    </ul>
{% endblock %}

{% block user %}
<div><a href="{% url 'profile' %}" class="resident-name-link">{{ user.resident.first_name }} {{ user.resident.last_name }}</a></div>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    
    <!-- Hero Banner -->
    <div class="hero-banner">
        <div class="hero-content">
            <div class="hero-greeting">
                <svg class="sparkle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 3L13.5 8.5L19 10L13.5 11.5L12 17L10.5 11.5L5 10L10.5 8.5L12 3Z"/>
                    <path d="M19 14L19.5 16L21 16.5L19.5 17L19 19L18.5 17L17 16.5L18.5 16L19 14Z"/>
                </svg>
                <h1>Good day, <a href="{% url 'profile' %}" class="resident-name-link">{{ user.resident.first_name }} {{ user.resident.last_name }}</a>!</h1>
            </div>
            <div class="office-hours-badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
                <span>Office Hours: Monday-Friday, 8:00 AM - 5:00 PM (except holidays)</span>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="main-grid">
        <!-- Left Column -->
        <div class="left-column">
            <!-- Next Appointment Card -->
            <div class="section-card">
                <div class="section-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2"/>
                        <path d="M16 2v4M8 2v4M3 10h18"/>
                    </svg>
                    <h2>Next Appointment</h2>
                </div>
                
                {% if next_appointment %}
                <div class="appointment-card-inner">
                    <div class="appointment-date-row">
                        <span class="appointment-date">{{ next_appointment.preferred_date|date:"l, F j, Y" }}</span>
                    </div>
                    <div class="appointment-session">
                        {% if next_appointment.preferred_time.hour < 12 %}
                        AM Session (8:00 AM - 12:00 PM)
                        {% else %}
                        PM Session (1:00 PM - 5:00 PM)
                        {% endif %}
                    </div>
                    
                    <div class="appointment-details">
                        <div class="detail-item">
                            <span class="detail-label">Certificate Type</span>
                            <span class="detail-value">{{ next_appointment.get_certificate_type_display }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Location</span>
                            <div class="location-value">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                                <span>Labangon Barangay Hall, 132 Katipunan St, Cebu City</span>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="{% url 'appointments' %}" class="view-all-link">View all appointments <span>&rarr;</span></a>
                {% else %}
                <div class="no-appointment">
                    <p>No upcoming appointments</p>
                    <a href="{% url 'certification' %}" class="book-now-link">Book an appointment now</a>
                </div>
                {% endif %}
            </div>

            <!-- Request Status Card -->
            <div class="section-card">
                <div class="section-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    <h2>Completed Requests</h2>
                </div>
                
                {% if completed_list %}
                    {% for appt in completed_list %}
                    <div class="request-item">
                        <div class="request-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                        </div>
                        <div class="request-info">
                            <span class="request-name">{{ appt.get_certificate_type_display }}</span>
                            <span class="request-date">{{ appt.preferred_date|date:"Y-m-d" }}</span>
                        </div>
                        <span class="status-badge completed">Completed</span>
                    </div>
                    {% endfor %}
                {% else %}
                <div class="no-requests">
                    <p>No completed requests yet</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Right Column - Barangay Services -->
        <div class="right-column">
            <div class="services-card">
                <h2>Barangay Services</h2>
                
                <div class="services-list">
                    <a href="{% url 'requirements' %}?certificate_type=barangay_clearance" class="service-item">
                        <div class="service-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                        </div>
                        <div class="service-info">
                            <span class="service-name">Barangay Clearance</span>
                            <span class="service-link">View Requirements</span>
                        </div>
                        <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </a>
                    
                    <a href="{% url 'requirements' %}?certificate_type=indigency" class="service-item">
                        <div class="service-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                        </div>
                        <div class="service-info">
                            <span class="service-name">Certificate of Indigency</span>
                            <span class="service-link">View Requirements</span>
                        </div>
                        <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </a>
                    
                    <a href="{% url 'requirements' %}?certificate_type=cedula" class="service-item">
                        <div class="service-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                        </div>
                        <div class="service-info">
                            <span class="service-name">Community Tax Certificate</span>
                            <span class="service-link">View Requirements</span>
                        </div>
                        <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </a>
                    
                    <a href="{% url 'requirements' %}?certificate_type=solo_parent" class="service-item">
                        <div class="service-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                        </div>
                        <div class="service-info">
                            <span class="service-name">Solo Parent Certificate</span>
                            <span class="service-link">View Requirements</span>
                        </div>
                        <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </a>
                </div>
                
                <a href="{% url 'certification' %}" class="book-appointment-btn">Book Appointment</a>
            </div>
        </div>
    </div>

    <!-- Contact Information -->
    <div class="resources-section">
        <div class="resources-grid">
            <div class="resource-card no-highlight">
                <h3>Contact Information</h3>
                <p>Email: barangay.labangon@yahoo.com</p>
                <p>Phone: 260-7194</p>
                <p>Address: Katipunan St., Labangon, Cebu City, Cebu 6000</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}