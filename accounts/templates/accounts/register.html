{% extends "accounts/index.html" %}
{% load static %}

{% block title %}Register{% endblock %}

{% block content %}
<div class="register-container">
    <div class="register-card">
        <div class="register-header">
            <h1>Create Your Account</h1>
            <p>Sign up to request certifications and schedule barangay services online</p>
        </div>

        <!-- User form error -->
        {% if user_form.non_field_errors %}
            <div class="alert alert-error">
                {% for error in user_form.non_field_errors %}
                    <p>{{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Resident form error -->
        {% if resident_form.non_field_errors %}
            <div class="alert alert-error">
                {% for error in resident_form.non_field_errors %}
                    <p>{{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <form method="post" class="register-form">
            {% csrf_token %}

            <div class="form-field">
                <label for="{{ user_form.email.id_for_label }}">{{ user_form.email.label }}</label>
                {{ user_form.email }}
                {% for error in user_form.email.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ resident_form.first_name.id_for_label }}">{{ resident_form.first_name.label }}</label>
                {{ resident_form.first_name }}
                {% for error in resident_form.first_name.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ resident_form.middle_name.id_for_label }}">{{ resident_form.middle_name.label }}</label>
                {{ resident_form.middle_name }}
                {% for error in resident_form.middle_name.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ resident_form.last_name.id_for_label }}">{{ resident_form.last_name.label }}</label>
                {{ resident_form.last_name }}
                {% for error in resident_form.last_name.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ resident_form.date_of_birth.id_for_label }}">{{ resident_form.date_of_birth.label }}</label>
                {{ resident_form.date_of_birth }}
                {% for error in resident_form.date_of_birth.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ resident_form.sex.id_for_label }}">{{ resident_form.sex.label }}</label>
                {{ resident_form.sex }}
                {% for error in resident_form.sex.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field full-width">
                <label for="{{ resident_form.address.id_for_label }}">{{ resident_form.address.label }}</label>
                {{ resident_form.address }}
                {% for error in resident_form.address.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ resident_form.phone_number.id_for_label }}">{{ resident_form.phone_number.label }}</label>
                {{ resident_form.phone_number }}
                {% for error in resident_form.phone_number.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ resident_form.civil_status.id_for_label }}">{{ resident_form.civil_status.label }}</label>
                {{ resident_form.civil_status }}
                {% for error in resident_form.civil_status.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ resident_form.citizenship.id_for_label }}">{{ resident_form.citizenship.label }}</label>
                {{ resident_form.citizenship }}
                {% for error in resident_form.citizenship.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ user_form.password1.id_for_label }}">{{ user_form.password1.label }}</label>
                {{ user_form.password1 }}
                {% for error in user_form.password1.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-field">
                <label for="{{ user_form.password2.id_for_label }}">{{ user_form.password2.label }}</label>
                {{ user_form.password2 }}
                {% for error in user_form.password2.errors %}
                    <span class="field-error">{{ error }}</span>
                {% endfor %}
            </div>

            <button type="submit" class="btn btn-register">Create Account</button>
        </form>

        <div class="register-footer">
            <p>Already have an account? <a href="{% url 'login' %}">Sign in</a></p>
        </div>
    </div>
</div>

<script>
    // Function to check if first letter is capitalized
    function checkCapitalization(input) {
        const value = input.value;
        if (value.length > 0 && !value[0].match(/[A-Z]/)) {
            input.setCustomValidity("This field must start with a capital letter.");
        } else {
            input.setCustomValidity("");
        }
    }

    // Add event listeners to name fields
    document.addEventListener('DOMContentLoaded', function() {
        // Get all input fields with name attributes containing 'name' or 'citizenship'
        const nameFields = document.querySelectorAll('input[name$="name"], input[name="citizenship"]');
        
        nameFields.forEach(function(field) {
            field.addEventListener('input', function() { 
                checkCapitalization(this); 
            });
        });
    });
</script>
{% endblock content %}