{% extends 'base.html' %}
{% load static %}
{% load staff_tags %}

{% block title %}Home | Barangay Online Appointment & Certification Magement System{% endblock %}

{% block appbar %}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'accounts/css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'appointments/css/certification.css' %}">
    {% block staff_css %}{% endblock %}
    {% block resident_css %}{% endblock %}
{% endblock %}

{% block user_logout %}

<form action="{% url 'logout' %}" method="post">
    {% csrf_token %}

    <div class="profile-popup">
        <div class="user-name" onclick="event.preventDefault()">
            {% if user.role == 'resident' %}
                {{ user.resident.first_name }} {{ user.resident.last_name }}
            {% elif user.role == 'staff' %}
                {{ user|get_staff_name }}
            {% else %}
                Barangay Office
            {% endif %}
        </div>

        <div class="popup-menu" id="profileMenu">
            {% if user.role == 'resident' %}
            <a href="{% url 'profile' %}"><div>Profile</div></a>
            {% endif %}
            <button type="submit">Logout</button>
        </div>
    </div>
</form>

    
    <script src="{% static 'accounts/js/popup.js' %}"></script>

{% endblock %}

{% block content %}
 
    <div class="title-welcome">
        <h2>Barangay Online Appointment and <br />Certification Management System.</h2>
    </div>

    <!-- Registration Pending Approval Modal -->
    <div id="approvalModal" class="modal" style="display: none;" data-show-modal="{% if request.session.show_approval_modal %}true{% else %}false{% endif %}">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Account Under Review</h2>
            </div>
            <div class="modal-body">
                <p>Your account registration is currently under review by our staff. You will receive an email notification once your account has been approved.</p>
                <p>Please check your email regularly for updates.</p>
                <div class="modal-actions">
                    <button id="closeModal" class="btn btn-primary">OK</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Show the modal if the session flag is set
document.addEventListener('DOMContentLoaded', function() {
    var modal = document.getElementById("approvalModal");
    var closeModalBtn = document.getElementById("closeModal");
    
    // Check if we need to show the modal
    var showApprovalModal = modal.getAttribute('data-show-modal') === 'true';
    
    if (showApprovalModal) {
        modal.style.display = "block";
        
        // Close modal when OK button is clicked
        closeModalBtn.onclick = function() {
            modal.style.display = "none";
            // Clear the session flag
            fetch('/clear_approval_modal/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                },
            });
        }
        
        // Close modal when clicking outside of it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
                // Clear the session flag
                fetch('/clear_approval_modal/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    },
                });
            }
        }
    }
});
    </script>
{% endblock %}
